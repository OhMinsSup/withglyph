generator client {
  provider = "prisma-client-js"
}

generator pothos {
  provider = "prisma-pothos-types"
}

datasource db {
  provider     = "mysql"
  url          = env("PRIVATE_DATABASE_URL")
  relationMode = "prisma"
}

model Image {
  id          String   @id @db.VarChar(32)
  name        String   @db.VarChar(256)
  format      String   @db.VarChar(8)
  fileSize    Int      @map("file_size")
  blobSize    Int      @map("blob_size")
  width       Int
  height      Int
  path        String   @db.VarChar(256)
  hash        String   @db.VarChar(256)
  placeholder String   @db.VarChar(1024)
  createdAt   DateTime @default(now()) @map("created_at")

  profileUsingThisAsAvatar Profile?

  @@map("images")
}

model Session {
  id        String   @id @db.VarChar(32)
  userId    String   @map("user_id") @db.VarChar(32)
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")

  @@index([userId])
  @@map("sessions")
}

model Space {
  id        String     @id @db.VarChar(32)
  slug      String     @db.VarChar(32)
  name      String     @db.VarChar(32)
  state     SpaceState
  createdAt DateTime   @default(now()) @map("created_at")

  members SpaceMember[]

  @@index([slug])
  @@map("spaces")
}

model SpaceMember {
  id        String          @id @db.VarChar(32)
  spaceId   String          @map("space_id") @db.VarChar(32)
  space     Space           @relation(fields: [spaceId], references: [id])
  userId    String          @map("user_id") @db.VarChar(32)
  user      User            @relation(fields: [userId], references: [id])
  profileId String          @map("profile_id") @db.VarChar(32)
  profile   Profile         @relation(fields: [profileId], references: [id])
  role      SpaceMemberRole
  createdAt DateTime        @default(now()) @map("created_at")

  @@unique([spaceId, userId])
  @@index([profileId])
  @@index([userId])
  @@map("space_members")
}

model Profile {
  id        String   @id @db.VarChar(32)
  name      String   @db.VarChar(32)
  avatarId  String   @unique @map("avatar_id") @db.VarChar(32)
  avatar    Image    @relation(fields: [avatarId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")

  spaces SpaceMember[]
  user   User?

  @@map("profiles")
}

model User {
  id        String    @id @db.VarChar(32)
  email     String    @unique @db.VarChar(256)
  password  String?   @db.VarChar(256)
  profileId String    @unique @map("profile_id") @db.VarChar(32)
  profile   Profile   @relation(fields: [profileId], references: [id])
  state     UserState
  createdAt DateTime  @default(now()) @map("created_at")

  sessions Session[]
  spaces   SpaceMember[]

  @@map("users")
}

enum SpaceState {
  ACTIVE
  INACTIVE
}

enum SpaceMemberRole {
  OWNER
  MEMBER
}

enum UserState {
  ACTIVE
  INACTIVE
}
